<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Mini CRM</title>

  <!-- Inter font -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800;900&display=swap" rel="stylesheet">

  <link rel="stylesheet" href="style.css" />

  <!-- Chart.js -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>
</head>
<body>

<div class="app">
  <!-- Mobile overlay -->
  <div class="overlay hidden" id="overlay" onclick="closeSidebarMobile()"></div>

  <!-- Sidebar -->
  <aside class="sidebar" id="sidebar">
    <div class="sb-top">
      <div class="brand">
        <span class="brand-dot"></span>
        <span class="brand-text">Mini CRM</span>
      </div>
      <div class="user-chip" id="navUsername">User</div>
    </div>

    <div class="sb-nav">
      <button type="button" class="sb-btn active" id="tabDashboard" onclick="showSection('dashboard')">
        <span class="sb-ico">üìä</span><span class="sb-label">Dashboard</span>
      </button>

      <button type="button" class="sb-btn" id="tabLeads" onclick="showSection('leads')">
        <span class="sb-ico">üßæ</span><span class="sb-label">Leads</span>
      </button>

      <button type="button" class="sb-btn" id="tabPipeline" onclick="showSection('pipeline')">
        <span class="sb-ico">üß©</span><span class="sb-label">Pipeline</span>
      </button>
    </div>

    <div class="sb-bottom">
      <button type="button" class="sb-btn danger" onclick="logout()">
        <span class="sb-ico">üö™</span><span class="sb-label">Logout</span>
      </button>
      
    </div>
  </aside>

  <!-- Main -->
  <main class="main">
    <div class="topbar">
      <button class="icon-btn nav-toggle" type="button" id="navToggle" onclick="toggleSidebar()" title="Toggle sidebar">‚üµ</button>

      <div class="topbar-left">
        <button class="icon-btn mobile-only" type="button" onclick="openSidebarMobile()" aria-label="Open menu">‚ò∞</button>
        <div>
          <div class="page-title" id="pageTitle">Dashboard</div>
          <div class="soft-note" id="softNote">Insights, pipeline & activity</div>
        </div>
      </div>

      <div class="topbar-actions">
        <button class="secondary-btn" type="button" onclick="refreshAll()" title="Refresh">‚ü≥ Refresh</button>
        <button class="secondary-btn" type="button" onclick="exportCSV()" title="Export filtered leads">‚§ì Export CSV</button>
        <button class="icon-btn" type="button" id="themeToggle" onclick="toggleTheme()" title="Toggle theme">üåô</button>
      </div>
    </div>

    <!-- ========================= DASHBOARD ========================= -->
    <section id="sectionDashboard">
      <div class="stats">
        <div class="card stat-card">
          <div class="stat-top">
            <h3>Total Leads</h3>
            <span class="badge">All</span>
          </div>
          <div class="counter" id="totalLeads">0</div>
          <div class="stat-foot"><span class="dot up"></span> Updated live</div>
        </div>

        <div class="card stat-card">
          <div class="stat-top">
            <h3>New Leads</h3>
            <span class="badge blue">New</span>
          </div>
          <div class="counter" id="newLeads">0</div>
          <div class="stat-foot"><span class="dot"></span> Needs follow-up</div>
        </div>

        <div class="card stat-card">
          <div class="stat-top">
            <h3>Contacted</h3>
            <span class="badge indigo">Contacted</span>
          </div>
          <div class="counter" id="contactedLeads">0</div>
          <div class="stat-foot"><span class="dot"></span> In progress</div>
        </div>

        <div class="card stat-card">
          <div class="stat-top">
            <h3>Converted</h3>
            <span class="badge lime">Converted</span>
          </div>
          <div class="counter" id="convertedLeads">0</div>
          <div class="stat-foot"><span class="dot"></span> Won</div>
        </div>
      </div>

      <div class="graphs">
        <div class="graph-card">
          <div class="card-head">
            <h3>Status Breakdown</h3>
            <div class="pill-mini">Last sync: <span id="syncTime">‚Äî</span></div>
          </div>
          <div class="chart-wrap">
            <canvas id="barChart" height="120"></canvas>
          </div>
        </div>

        <div class="graph-card">
          <div class="card-head">
            <h3>Conversion</h3>
            <div class="pill-mini">Rate: <span id="conversionRateText">0%</span></div>
          </div>
          <div class="chart-wrap donut-wrap">
            <canvas id="donutChart"></canvas>
          </div>
          <div class="mini-kpis">
            <div class="mini-kpi">
              <div class="mini-kpi-label">New</div>
              <div class="mini-kpi-val" id="kpiNew">0</div>
            </div>
            <div class="mini-kpi">
              <div class="mini-kpi-label">Contacted</div>
              <div class="mini-kpi-val" id="kpiContacted">0</div>
            </div>
            <div class="mini-kpi">
              <div class="mini-kpi-label">Converted</div>
              <div class="mini-kpi-val" id="kpiConverted">0</div>
            </div>
          </div>
        </div>
      </div>

      <!-- Activity + Top leads -->
      <div class="dash-bottom">
        <div class="graph-card">
          <div class="card-head">
            <h3>Activity Timeline</h3>
            <div class="pill-mini">
              <button class="link-btn" type="button" onclick="clearActivity()">Clear</button>
            </div>
          </div>
          <div class="timeline" id="timeline"></div>
        </div>

        <div class="graph-card">
          <div class="card-head">
            <h3>Top Leads (Score)</h3>
            <div class="pill-mini">Auto scoring</div>
          </div>
          <div class="top-leads" id="topLeads"></div>
        </div>
      </div>
    </section>

    <!-- ========================= LEADS ========================= -->
    <section id="sectionLeads" class="hidden">
      <div class="section-head">
        <div>
          <div class="section-title">Leads</div>
          <div class="section-sub">
            Search, filter, update status, delete, bulk actions ‚Ä¢ <span class="kbd">/</span> search ‚Ä¢ <span class="kbd">N</span> new lead
          </div>
        </div>

        <div class="section-actions">
          <button type="button" class="primary-btn" onclick="openLeadForm()">+ Add Lead</button>
        </div>
      </div>

      <!-- Bulk bar (NO TAGS) -->
      <div class="bulkbar hidden" id="bulkBar">
        <div class="bulk-left">
          <span class="bulk-pill"><b id="bulkCount">0</b> selected</span>
          <button class="link-btn" type="button" onclick="clearSelection()">Clear</button>
        </div>

        <div class="bulk-right">
          <label class="mini-label">
            Set status
            <select id="bulkStatus" onchange="bulkSetStatus(this.value)">
              <option value="">‚Äî</option>
              <option value="new">new</option>
              <option value="contacted">contacted</option>
              <option value="converted">converted</option>
            </select>
          </label>

          <button class="danger-mini" type="button" onclick="bulkDelete()">Delete</button>
        </div>
      </div>

      <!-- Manual lead form -->
      <div class="form-card hidden" id="leadFormCard">
        <div class="form-head">
          <h3>Add Lead </h3>
          <button type="button" class="close-btn" onclick="closeLeadForm()">‚úï</button>
        </div>

        <form id="leadForm" class="lead-form">
          <div class="form-row">
            <input type="text" id="leadName" placeholder="Name" required />
            <input type="email" id="leadEmail" placeholder="Email" required />
          </div>

          <div class="form-row">
            <input type="text" id="leadPhone" placeholder="Phone" />
            <select id="leadStatus">
              <option value="new">new</option>
              <option value="contacted">contacted</option>
              <option value="converted">converted</option>
            </select>
          </div>

          <div class="form-actions">
            <button type="submit" class="primary-btn">Save Lead</button>
            <button type="button" class="secondary-btn" onclick="closeLeadForm()">Cancel</button>
          </div>

          <p id="leadMsg" class="form-msg"></p>
        </form>
      </div>

      <!-- Leads table (NO TAG COLUMN) -->
      <div class="table-card" id="leadsTableCard">
        <div class="table-tools">
          <div class="searchbox">
            <span class="search-ico">üîé</span>
            <input id="leadSearch" type="text" placeholder="Search by name/email/phone..." oninput="applyLeadFilters()" />
            <button class="clear-btn" type="button" onclick="clearSearch()" title="Clear search">√ó</button>
          </div>

          <div class="tools-right">
            <div class="filters">
              <button type="button" class="pill active" data-filter="all" onclick="setStatusFilter('all')">All</button>
              <button type="button" class="pill" data-filter="new" onclick="setStatusFilter('new')">New</button>
              <button type="button" class="pill" data-filter="contacted" onclick="setStatusFilter('contacted')">Contacted</button>
              <button type="button" class="pill" data-filter="converted" onclick="setStatusFilter('converted')">Converted</button>
            </div>

            <div class="pager-controls">
              <label class="mini-label">
                Page size
                <select id="pageSize" onchange="setPageSize(this.value)">
                  <option value="5">5</option>
                  <option value="10" selected>10</option>
                  <option value="20">20</option>
                  <option value="50">50</option>
                </select>
              </label>
            </div>
          </div>
        </div>

        <div class="table-wrapper">
          <table>
            <thead>
              <tr>
                <th style="min-width:64px;">
                  <input type="checkbox" id="selectAll" onclick="toggleSelectAll(this.checked)" />
                </th>
                <th style="min-width:220px;">Lead</th>
                <th style="min-width:220px;">Email</th>
                <th style="min-width:140px;">Phone</th>
                <th style="min-width:160px;">Score</th>
                <th style="min-width:240px;">Status</th>
                <th style="min-width:190px;">Actions</th>
              </tr>
            </thead>
            <tbody id="leadsTable"></tbody>
          </table>
        </div>

        <div class="table-footer">
          <div class="table-meta">
            Showing <b id="showingCount">0</b> of <b id="totalCount">0</b>
          </div>

          <div class="pager">
            <button class="secondary-btn" type="button" onclick="prevPage()">‚Üê Prev</button>
            <div class="page-chip">Page <b id="pageNumber">1</b> / <b id="pageTotal">1</b></div>
            <button class="secondary-btn" type="button" onclick="nextPage()">Next ‚Üí</button>
          </div>
        </div>
      </div>
    </section>

    <!-- ========================= PIPELINE (KANBAN) ========================= -->
    <section id="sectionPipeline" class="hidden">
      <div class="section-head">
        <div>
          <div class="section-title">Pipeline</div>
          <div class="section-sub">Drag cards between columns to update status ‚Ä¢ Notes supported</div>
        </div>

        <div class="section-actions">
          <button class="secondary-btn" type="button" onclick="loadLeads()">Sync Leads</button>
        </div>
      </div>

      <div class="kanban">
        <div class="kan-col" data-status="new" ondragover="allowDrop(event)" ondrop="dropCard(event,'new')">
          <div class="kan-head">
            <div class="kan-title">New</div>
            <div class="kan-count" id="kanCountNew">0</div>
          </div>
          <div class="kan-body" id="kanNew"></div>
        </div>

        <div class="kan-col" data-status="contacted" ondragover="allowDrop(event)" ondrop="dropCard(event,'contacted')">
          <div class="kan-head">
            <div class="kan-title">Contacted</div>
            <div class="kan-count" id="kanCountContacted">0</div>
          </div>
          <div class="kan-body" id="kanContacted"></div>
        </div>

        <div class="kan-col" data-status="converted" ondragover="allowDrop(event)" ondrop="dropCard(event,'converted')">
          <div class="kan-head">
            <div class="kan-title">Converted</div>
            <div class="kan-count" id="kanCountConverted">0</div>
          </div>
          <div class="kan-body" id="kanConverted"></div>
        </div>
      </div>
    </section>

  </main>
</div>

<!-- Toasts -->
<div class="toast-wrap" id="toastWrap"></div>

<!-- Notes Modal (NO TAG UI) -->
<div class="modal hidden" id="notesModal" role="dialog" aria-modal="true">
  <div class="modal-card">
    <div class="modal-head">
      <div>
        <div class="modal-title">Lead Notes</div>
        <div class="modal-sub" id="notesLeadMeta">‚Äî</div>
      </div>
      <button class="icon-btn" type="button" onclick="closeNotes()" aria-label="Close">‚úï</button>
    </div>

    <div style="margin-top:12px;">
      <div class="modal-label">Notes</div>
      <textarea id="notesText" class="notes-area" placeholder="Write call summary, next steps, follow-up notes..."></textarea>
      <div class="small-hint" id="notesHint">Saved to backend if endpoint exists, otherwise saved locally.</div>
    </div>

    <div class="modal-actions">
      <button class="primary-btn" type="button" onclick="saveNotes()">Save</button>
      <button class="secondary-btn" type="button" onclick="closeNotes()">Close</button>
    </div>
  </div>
</div>

<script src="script.js">

</script>

</body>
</html>
